# Electron 踩坑记录

本文档记录在使用 Electron 开发过程中遇到的各种问题和解决方案。

---

## 环境配置

### 问题 1: Electron 依赖安装失败

**问题描述：**
在使用 `npm install` 或 `pnpm install` 安装项目依赖时，Electron 二进制文件经常下载失败。这通常是由于网络问题（GitHub 访问受限、下载超时等）导致的。

**错误信息：**
常见的错误信息包括：
```
Error: connect ETIMEDOUT
Error: read ECONNRESET
Error: socket hang up
Failed to download electron
```

**解决方案：**

#### 手动下载并修改 install.js 使用本地 zip 文件

1. **确定需要的 Electron 版本**
   - 查看 `package.json` 中的 `electron` 版本（例如：`^29.1.1`）
   - 或者查看 `node_modules/electron/package.json` 中的版本号

2. **下载对应平台的 Electron zip 文件**
   - 访问 [Electron Releases](https://github.com/electron/electron/releases)
   - 找到对应版本的发布页面
   - 根据你的操作系统下载对应的 zip 文件：
     - **Windows x64**: `electron-v{version}-win32-x64.zip`
     - **Windows x32**: `electron-v{version}-win32-ia32.zip`
     - **Windows ARM64**: `electron-v{version}-win32-arm64.zip`
     - **macOS x64**: `electron-v{version}-darwin-x64.zip`
     - **macOS ARM64**: `electron-v{version}-darwin-arm64.zip`
     - **Linux x64**: `electron-v{version}-linux-x64.zip`

3. **放置 zip 文件**
   - 将下载的 zip 文件放到 `node_modules/electron/` 同级目录（即 `node_modules/` 目录下）
   - 例如：`node_modules/electron-v21.4.2-win32-x64.zip`

4. **修改 `node_modules/electron/install.js` 文件**
   - 打开 `node_modules/electron/install.js` 文件
   - 找到第 42-53 行的代码（被注释的 `downloads if not cached` 部分）
   - **删除第 42-53 行的所有注释代码**
   - 确保第 42 行是 `extractFile` 调用，并传入 zip 文件名（相对路径）

   修改前（第 41-53 行）：
   ```javascript
   // downloads if not cached
   downloadArtifact({
      version,
      artifactName: 'electron',
      force: process.env.force_no_cache === 'true',
      cacheRoot: process.env.electron_config_cache,
      checksums: (process.env.electron_use_remote_checksums || process.env.npm_config_electron_use_remote_checksums) ? undefined : require('./checksums.json'),
      platform,
      arch
    }).then(extractFile).catch(err => {
      console.error(err.stack);
      process.exit(1);
   });
   ```

   修改后（删除第 42-53 行，只保留 extractFile 调用）：
   ```javascript
   // downloads if not cached
   extractFile(`electron-v21.4.2-win32-x64.zip`)
   ```

   **注意：** 根据实际情况修改 zip 文件名中的版本号

5. **执行 postinstall 命令**
   - 进入 `node_modules/electron/` 目录
   - 执行命令：`npm run postinstall` 或 `node install.js`
   - 等待解压完成

6. **验证安装**
   - 运行 `npx electron --version` 验证是否安装成功
   - 或者直接运行 `npm run dev` 测试

**注意事项：**
- 确保下载的版本与 `package.json` 中指定的版本匹配
- 如果使用 `^` 或 `~` 版本范围，需要确认实际安装的具体版本
- 不同平台需要下载对应平台的二进制文件
- 此方法仅适用于临时解决下载问题，重新安装依赖后需要再次修改

**相关链接：**
- [Electron Releases](https://github.com/electron/electron/releases)
- [Electron 官方文档 - 安装](https://www.electronjs.org/docs/latest/tutorial/installation)

---