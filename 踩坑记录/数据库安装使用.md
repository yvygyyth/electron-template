# better-sqlite3 在 Electron 中的安装问题

## 问题描述

安装 `better-sqlite3` 依赖后，直接运行 Electron 应用时出现错误，提示找不到 `.node` 绑定文件。

## 错误信息

```
(node:11700) UnhandledPromiseRejectionWarning: Error: Could not locate the bindings file. Tried:
 → D:\WWW\electron\electron-vite-vue\node_modules\.pnpm\better-sqlite3@12.5.0\node_modules\better-sqlite3\build\better_sqlite3.node
 → D:\WWW\electron\electron-vite-vue\node_modules\.pnpm\better-sqlite3@12.5.0\node_modules\better-sqlite3\build\Release\better_sqlite3.node
 ... (更多路径)
    at bindings (bindings.js:126:9)
    at new Database (database.js:48:64)
    at getDatabase (index.js:18:20)
```

## 问题原因

`better-sqlite3` 是一个包含 C++ 代码的 native Node.js 模块，需要编译成 `.node` 文件才能使用。

**核心问题**：

- 安装时：`pnpm install` 会针对**系统的 Node.js 版本**编译 `better-sqlite3`
- 运行时：Electron 使用**自己的 Node.js 版本**（与系统版本不同）
- 结果：Electron 无法加载为系统 Node.js 编译的 `.node` 文件，导致 ABI 版本不匹配

## 解决方案：使用 electron-rebuild

### 工作原理

`electron-rebuild` 会：

1. 自动检测 Electron 版本
2. 扫描所有 native 模块（如 `better-sqlite3`）
3. 使用 Electron 的 Node.js 版本重新编译这些模块
4. 生成与 Electron 兼容的 `.node` 文件

### 解决方法

运行：

```bash
pnpm rebuild
```

### 验证

重建成功后，运行应用测试：

```bash
pnpm dev
```

如果不再出现 bindings file 错误，说明问题已解决。

## 注意事项

1. **需要构建工具**：Windows 需要安装 Visual Studio Build Tools 或 Visual Studio（选择 "使用 C++ 的桌面开发" 工作负载）
2. **Electron 版本更新**：如果更新了 Electron 版本，需要重新运行 `electron-rebuild`
3. **已安装 electron-rebuild**：项目已安装 `electron-rebuild@^3.2.9`，可以直接使用
